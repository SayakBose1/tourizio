<!-- Floating Chatbot -->
<div class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
  <!-- Chat toggle button -->
  <button
    *ngIf="!isOpen"
    class="group relative bg-gradient-to-r from-blue-500 to-indigo-500 text-white w-16 h-16 rounded-full shadow-2xl hover:shadow-blue-500/50 hover:scale-110 transition-all duration-300 flex items-center justify-center"
    (click)="toggleChat()"
  >
    <svg
      class="w-7 h-7"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 508 508"
      xml:space="preserve"
    >
      <path
        style="fill: #ffffff"
        d="M303.7,303.3c30.5-17.3,51-50.1,51-87.6c0-55.7-45.1-100.8-100.8-100.8S153.2,160,153.2,215.6
        c0,37.6,20.6,70.3,51,87.6C141,319.3,89.7,365,66,424.8c46.5,51.1,113.5,83.2,188,83.2s141.5-32.1,188-83.2
        C418.3,365,367,319.3,303.7,303.3z"
      />
      <path
        style="fill: #000000"
        d="M401.6,182.3h-15.8C370.9,123.4,317.5,79.6,254,79.6s-116.9,43.7-131.8,102.7h-15.8
        c-5.4,0-9.8,4.4-9.8,9.8V240c0,5.4,4.4,9.8,9.8,9.8h20c6.1,0,10.8-5.5,9.7-11.4c-2-10.4-2.7-21.3-1.8-32.5
        c4.8-59.3,53.6-106.9,113.1-110.1c69.2-3.8,126.8,51.5,126.8,119.9c0,7.8-0.8,15.3-2.2,22.7c-1.2,6,3.6,11.5,9.6,11.5h1.8
        c-4.2,13-14.9,37.2-38.3,50.2c-19.6,10.9-44.3,11.9-73.4,2.8c-1.5-6.7-8.9-14.6-16.5-18.3c-9.8-4.9-15.9-0.8-19.4,6.2
        s-3,14.3,6.7,19.2c8.6,4.3,21.6,5.2,27,0.5c13.9,4.3,26.9,6.5,39,6.5c15,0,28.5-3.3,40.4-10c27.5-15.3,38.8-43.7,42.8-57.2h9.9
        c5.4,0,9.8-4.4,9.8-9.8v-47.9C411.4,186.7,407,182.3,401.6,182.3z"
      />
    </svg>
  </button>

  <!-- Chat window -->
  <div
    *ngIf="isOpen"
    class="fixed bottom-6 right-6 w-96 h-[600px] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 animate-slide-up left-1/2 -translate-x-1/2 w-[90vw] max-w-[90vw] h-[75vh] max-h-[80vh] sm:left-auto sm:translate-x-0 sm:w-96 sm:h-[600px] sm:max-w-none sm:max-h-none sm:bottom-6 sm:right-6"
  >
    <!-- Header -->
    <div
      class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white p-4 flex justify-between items-center"
    >
      <div class="flex items-center gap-3">
        <div class="relative">
          <div
            class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-6 h-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              />
            </svg>
          </div>
          <span
            class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"
          ></span>
        </div>
        <div>
          <p class="font-bold text-lg">Tourizio Assistant</p>
          <p class="text-xs text-white/80 flex items-center gap-1">
            <span
              class="w-2 h-2 bg-green-400 rounded-full animate-pulse"
            ></span>
            Online
          </p>
        </div>
      </div>
      <button
        (click)="toggleChat()"
        class="w-8 h-8 hover:bg-white/20 rounded-full transition-all flex items-center justify-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>

    <!-- Messages container -->
    <div
      #messagesContainer
      (scroll)="onScroll($event)"
      class="flex-1 p-4 overflow-y-auto space-y-4 bg-gradient-to-b from-gray-50 to-white"
      style="scroll-behavior: smooth; -webkit-overflow-scrolling: touch"
    >
      <!-- Welcome message -->
      <div
        *ngIf="messages.length === 0"
        class="flex flex-col items-center justify-center h-full text-center px-4"
      >
        <div
          class="w-16 h-16 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-8 h-8 text-blue-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-bold text-gray-900 mb-2">
          Hi! I'm your travel assistant
        </h3>
        <p class="text-sm text-gray-600 mb-4">
          Ask me anything about destinations, hotels, packages, or bookings!
        </p>
      </div>

      <!-- Messages -->
      <div
        *ngFor="let msg of messages"
        class="flex flex-col"
        [class.items-end]="msg.user === 'You'"
      >
        <div
          class="flex gap-2 max-w-[85%]"
          [class.flex-row-reverse]="msg.user === 'You'"
        >
          <!-- Avatar -->
          <div
            class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center"
            [class.bg-blue-600]="msg.user === 'You'"
            [class.bg-gradient-to-br]="msg.user === 'AI'"
            [class.from-indigo-500]="msg.user === 'AI'"
            [class.to-purple-500]="msg.user === 'AI'"
          >
            <svg
              *ngIf="msg.user === 'You'"
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
            <svg
              *ngIf="msg.user === 'AI'"
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              />
            </svg>
          </div>

          <!-- Message bubble -->
          <div class="flex flex-col gap-2">
            <div
              class="rounded-2xl px-4 py-3 shadow-sm"
              [class.bg-gradient-to-r]="msg.user === 'You'"
              [class.from-blue-600]="msg.user === 'You'"
              [class.to-indigo-600]="msg.user === 'You'"
              [class.text-white]="msg.user === 'You'"
              [class.bg-white]="msg.user === 'AI'"
              [class.text-gray-800]="msg.user === 'AI'"
              [class.border]="msg.user === 'AI'"
              [class.border-gray-200]="msg.user === 'AI'"
            >
              <p class="text-sm leading-relaxed whitespace-pre-line">
                {{ msg.text }}
              </p>
            </div>

            <!-- Destination Image (only for AI messages) -->
            <div
              *ngIf="msg.user === 'AI' && msg.image"
              class="rounded-xl overflow-hidden shadow-md"
            >
              <img
                [src]="msg.image"
                [alt]="'Destination'"
                class="w-full h-40 object-cover"
                loading="lazy"
              />
            </div>

            <!-- Suggestions (only for AI messages) -->
            <div
              *ngIf="
                msg.user === 'AI' &&
                msg.suggestions &&
                msg.suggestions.length > 0
              "
              class="flex flex-wrap gap-2 mt-1"
            >
              <button
                *ngFor="let suggestion of msg.suggestions"
                (click)="handleSuggestionClick(suggestion)"
                class="text-xs bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full hover:bg-blue-100 transition-all border border-blue-200 font-medium"
              >
                {{ suggestion }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Typing indicator -->
      <div *ngIf="isTyping" class="flex gap-2">
        <div
          class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5 text-white"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
            />
          </svg>
        </div>
        <div
          class="bg-white border border-gray-200 rounded-2xl px-4 py-3 shadow-sm"
        >
          <div class="flex gap-1">
            <span
              class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
              style="animation-delay: 0s"
            ></span>
            <span
              class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
              style="animation-delay: 0.2s"
            ></span>
            <span
              class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
              style="animation-delay: 0.4s"
            ></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick replies -->
    <div
      *ngIf="messages.length === 0"
      class="px-4 py-3 border-t bg-gray-50 sm:px-4 sm:py-3 px-2 py-2"
    >
      <p
        class="text-xs text-gray-600 font-semibold mb-2 sm:mb-2 mb-1 text-center sm:text-left"
      >
        Quick Actions
      </p>
      <div
        class="flex flex-wrap gap-2 sm:gap-2 gap-1 justify-center sm:justify-start"
      >
        <button
          *ngFor="let reply of quickReplies"
          (click)="selectQuickReply(reply)"
          class="bg-white border border-gray-200 text-gray-700 px-3 py-2 sm:px-3 sm:py-2 px-2 py-1 rounded-lg hover:bg-gray-100 hover:border-blue-300 transition-all text-sm sm:text-sm text-xs font-medium shadow-sm flex items-center gap-2"
        >
          <span *ngIf="reply === 'Popular Destinations'">🏖️</span>
          <span *ngIf="reply === 'Beach Getaways'">🌊</span>
          <span *ngIf="reply === 'Hill Stations'">🏔️</span>
          <span *ngIf="reply === 'Budget Travel Tips'">💰</span>
          {{ reply }}
        </button>
      </div>
    </div>

    <!-- Input area -->
    <div class="p-4 border-t bg-white">
      <div class="flex gap-2">
        <div class="flex-1 relative">
          <input
            [(ngModel)]="userInput"
            placeholder="Ask me anything..."
            class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 pr-10 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all text-sm"
            (keyup.enter)="sendMessage()"
            [disabled]="isTyping"
          />
          <button
            class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
            (click)="userInput = ''"
          >
            <svg
              *ngIf="userInput"
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <button
          (click)="sendMessage()"
          [disabled]="!userInput.trim() || isTyping"
          class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 12h14M12 5l7 7-7 7"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Powered by -->
    <div class="px-4 py-2 bg-gray-50 border-t text-center">
      <p class="text-xs text-gray-500">Powered by AI • Tourizio Assistant</p>
    </div>
  </div>
</div>
