<!-- Floating Chatbot -->
<div class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
  <!-- Chat toggle button -->
  <button
    *ngIf="!isOpen"
    class="group relative bg-gradient-to-r from-blue-600 to-indigo-600 text-white w-16 h-16 rounded-full shadow-2xl hover:shadow-blue-500/50 hover:scale-110 transition-all duration-300 flex items-center justify-center"
    (click)="toggleChat()"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="w-7 h-7"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
      />
    </svg>
  </button>

  <!-- Chat window -->
  <div
    *ngIf="isOpen"
    class="w-96 h-[600px] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 animate-slide-up"
  >
    <!-- Header -->
    <div
      class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white p-4 flex justify-between items-center"
    >
      <div class="flex items-center gap-3">
        <div class="relative">
          <div
            class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-6 h-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              />
            </svg>
          </div>
          <span
            class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 border-2 border-white rounded-full"
          ></span>
        </div>
        <div>
          <p class="font-bold text-lg">Tourizio Assistant</p>
          <p class="text-xs text-white/80 flex items-center gap-1">
            <span
              class="w-2 h-2 bg-green-400 rounded-full animate-pulse"
            ></span>
            Online
          </p>
        </div>
      </div>
      <button
        (click)="toggleChat()"
        class="w-8 h-8 hover:bg-white/20 rounded-full transition-all flex items-center justify-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>

    <!-- Messages container -->
    <div
      #messagesContainer
      class="flex-1 p-4 overflow-y-auto space-y-4 bg-gradient-to-b from-gray-50 to-white"
      style="scroll-behavior: smooth; -webkit-overflow-scrolling: touch"
    >
      <!-- Welcome message -->
      <div
        *ngIf="messages.length === 0"
        class="flex flex-col items-center justify-center h-full text-center px-4"
      >
        <div
          class="w-16 h-16 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-8 h-8 text-blue-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-bold text-gray-900 mb-2">
          Hi! I'm your travel assistant
        </h3>
        <p class="text-sm text-gray-600 mb-4">
          Ask me anything about destinations, hotels, packages, or bookings!
        </p>
      </div>

      <!-- Messages -->
      <div
        *ngFor="let msg of messages"
        class="flex"
        [class.justify-end]="msg.user === 'You'"
      >
        <div
          class="flex gap-2 max-w-[80%]"
          [class.flex-row-reverse]="msg.user === 'You'"
        >
          <!-- Avatar -->
          <div
            class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center"
            [class.bg-blue-600]="msg.user === 'You'"
            [class.bg-gradient-to-br]="msg.user === 'AI'"
            [class.from-indigo-500]="msg.user === 'AI'"
            [class.to-purple-500]="msg.user === 'AI'"
          >
            <svg
              *ngIf="msg.user === 'You'"
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
            <svg
              *ngIf="msg.user === 'AI'"
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              />
            </svg>
          </div>

          <!-- Message bubble -->
          <div
            class="rounded-2xl px-4 py-3 shadow-sm"
            [class.bg-gradient-to-r]="msg.user === 'You'"
            [class.from-blue-600]="msg.user === 'You'"
            [class.to-indigo-600]="msg.user === 'You'"
            [class.text-white]="msg.user === 'You'"
            [class.bg-white]="msg.user === 'AI'"
            [class.text-gray-800]="msg.user === 'AI'"
            [class.border]="msg.user === 'AI'"
            [class.border-gray-200]="msg.user === 'AI'"
          >
            <p class="text-sm leading-relaxed">{{ msg.text }}</p>
          </div>
        </div>
      </div>

      <!-- Typing indicator -->
      <div *ngIf="isTyping" class="flex gap-2">
        <div
          class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5 text-white"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
            />
          </svg>
        </div>
        <div
          class="bg-white border border-gray-200 rounded-2xl px-4 py-3 shadow-sm"
        >
          <div class="flex gap-1">
            <span
              class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
              style="animation-delay: 0s"
            ></span>
            <span
              class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
              style="animation-delay: 0.2s"
            ></span>
            <span
              class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
              style="animation-delay: 0.4s"
            ></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick replies -->
    <div *ngIf="messages.length === 0" class="px-4 py-3 border-t bg-gray-50">
      <p class="text-xs text-gray-600 font-semibold mb-2">Quick Actions</p>
      <div class="flex flex-wrap gap-2">
        <button
          *ngFor="let reply of quickReplies"
          (click)="selectQuickReply(reply)"
          class="bg-white border border-gray-200 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-100 hover:border-blue-300 transition-all text-sm font-medium shadow-sm flex items-center gap-2"
        >
          <span *ngIf="reply === 'Destinations'">🏖️</span>
          <span *ngIf="reply === 'Rides'">🚗</span>
          <span *ngIf="reply === 'Hotels'">🏨</span>
          <span *ngIf="reply === 'Packages'">📦</span>
          {{ reply }}
        </button>
      </div>
    </div>

    <!-- Input area -->
    <div class="p-4 border-t bg-white">
      <div class="flex gap-2">
        <div class="flex-1 relative">
          <input
            [(ngModel)]="userInput"
            placeholder="Ask me anything..."
            class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 pr-10 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all text-sm"
            (keyup.enter)="sendMessage()"
            [disabled]="isTyping"
          />
          <button
            class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
            (click)="userInput = ''"
          >
            <svg
              *ngIf="userInput"
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <button
          (click)="sendMessage()"
          [disabled]="!userInput.trim() || isTyping"
          class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 12h14M12 5l7 7-7 7"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Powered by -->
    <div class="px-4 py-2 bg-gray-50 border-t text-center">
      <p class="text-xs text-gray-500">Powered by AI • Tourizio Assistant</p>
    </div>
  </div>
</div>
